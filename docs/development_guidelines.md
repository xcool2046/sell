# 销售信息管理系统 - 开发规范与原则 (最终版)

## 1. 核心原则

本文档为开发团队提供一套统一的技术规范和基本原则，旨在提高代码质量、开发效率，并最大程度地减少重复性工作和Bug。所有开发人员必须遵守本文档。

### 1.1. DRY原则 (Don't Repeat Yourself - 不要重复你自己)
这是最重要的核心原则。任何重复出现的代码块或逻辑，都应被抽象和封装成可复用的单元。

- **后端**:
  - **业务逻辑复用**: 通用的业务逻辑（如：生成订单号、检查库存）应被封装到单独的`服务层(Service Layer)`中，供所有API控制器(Controller)调用。
  - **横切关注点复用**: 通用的功能，如日志记录、权限校验、异常处理，必须通过`中间件(Middleware)`或`过滤器(Filter)`实现，严禁在每个API接口中单独实现。
- **前端**:
  - **UI组件复用**: 通用的UI元素，如带有搜索、列表、分页功能的完整视图、选择客户/产品的弹窗，都应被封装成可复用的`用户控件(UserControl)`。
  - **数据模型复用**: 从API获取的数据结构，应定义为统一的`数据模型(Model)`或`视图模型(ViewModel)`，在整个应用中共享。
  - **样式复用**: 所有颜色、字体、边距等UI常量，必须定义在统一的`资源字典(ResourceDictionary)`中，并通过`StaticResource`或`DynamicResource`引用。

---

## 2. 统一错误与异常处理

为了提供一致的用户体验和便于调试，必须采用统一的错误处理流程。

- **后端**:
  - 必须创建一个全局的`异常处理中间件`。
  - 所有的API在遇到错误时，无论业务异常或系统异常，都应返回统一的JSON格式：
    ```json
    {
      "success": false,
      "error_code": "RESOURCE_NOT_FOUND",
      "message": "找不到指定的客户信息"
    }
    ```
- **前端**:
  - 必须创建一个统一的API客户端服务（如`ApiClient.cs`），封装所有`HttpClient`请求。
  - 在该服务中，统一处理所有API返回的错误。根据`success: false`来判断，并根据`message`字段向用户弹出统一风格的错误提示框。

---

## 3. 自动化与脚本化

- **数据库迁移**: 数据库结构的任何变更，都必须通过`Entity Framework Core Migrations`工具生成迁移脚本来完成，严禁手动修改生产数据库。
- **依赖包管理**: 前后端项目统一使用各自的包管理工具（NuGet for .NET），确保所有开发人员和服务器上的依赖版本一致。
- **部署**: 生产环境的部署流程应被脚本化，实现一键部署，减少人为失误。

---

## 4. 代码风格与规范
- **命名**: 所有变量、方法、类的命名，必须清晰、表意，并遵循.NET社区的官方命名规范（如`PascalCase`用于方法和属性，`camelCase`用于局部变量）。
- **注释**: 对复杂的业务逻辑或非直观的代码，必须添加清晰的注释。
- **版本控制**: 所有代码必须通过 Git 进行版本控制。每次提交(commit)都必须包含有意义的说明信息。

---

## 5. 数据校验与用户反馈规范

为了确保数据质量和优秀的用户体验，所有数据输入都必须经过严格校验，并向用户提供清晰的反馈。

- **前端先行校验 (Client-Side Validation)**: 所有“保存”、“创建”、“更新”等操作前，前端必须对用户输入进行非空和格式校验。不满足条件时，应阻止API请求的发送，并在界面上通过高亮输入框、文字提示等方式，明确告知用户哪个字段不符合要求。
- **后端兜底校验 (Server-Side Validation)**: 所有接收数据的API端点，必须对传入的DTO模型进行数据注解校验 (`[Required]`, `[StringLength]`, etc.)。即使前端校验被绕过，后端也必须能阻止非法数据的持久化。
- **清晰的反馈信息**:
  - **错误提示**: 当校验失败时，无论是前端还是后端返回的错误，都必须以清晰、友好、非技术性的语言告知用户。例如：“客户名称不能为空”，而不是“`Name` field is required”。
  - **成功提示**: 对于所有成功的创建、更新、删除操作，系统应给予用户一个短暂的、明确的成功提示。例如：“客户信息保存成功”。