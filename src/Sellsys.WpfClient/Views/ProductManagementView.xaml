<UserControl x:Class="Sellsys.WpfClient.Views.ProductManagementView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:viewmodels="clr-namespace:Sellsys.WpfClient.ViewModels"
             d:DataContext="{d:DesignInstance Type=viewmodels:ProductManagementViewModel}"
             mc:Ignorable="d"
             d:DesignHeight="600" d:DesignWidth="1000">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/> <!-- Title and Search -->
            <RowDefinition Height="Auto"/> <!-- Action Buttons -->
            <RowDefinition Height="*"/>    <!-- Data Grid -->
        </Grid.RowDefinitions>

        <!-- Title and Search Section -->
        <Grid Grid.Row="0" Margin="0,0,0,20">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <!-- Title -->
            <TextBlock Grid.Column="0"
                       Text="产品管理"
                       Style="{StaticResource ModuleTitleStyle}"
                       VerticalAlignment="Center"/>

            <!-- Search and Filter Section -->
            <StackPanel Grid.Column="2" Orientation="Horizontal">
                <TextBox x:Name="SearchTextBox"
                         Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
                         Style="{StaticResource StandardTextBoxStyle}"
                         Width="200"
                         Margin="0,0,10,0"
                         ToolTip="搜索产品名称或型号规格">
                    <TextBox.InputBindings>
                        <KeyBinding Key="Enter" Command="{Binding SearchCommand}"/>
                    </TextBox.InputBindings>
                </TextBox>
                <Button Content="查询"
                        Command="{Binding SearchCommand}"
                        Style="{StaticResource PrimaryButtonStyle}"
                        Width="80"
                        Height="32"
                        Margin="0,0,10,0"/>
                <Button Content="重置"
                        Command="{Binding ResetCommand}"
                        Style="{StaticResource DeleteButtonStyle}"
                        Width="80"
                        Height="32"
                        Margin="0"/>
            </StackPanel>
        </Grid>

        <!-- Action Buttons -->
        <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="0,0,0,15">
            <Button Content="添加产品"
                    Command="{Binding AddProductCommand}"
                    Style="{StaticResource PrimaryButtonStyle}"
                    Width="100"
                    Height="35"
                    Margin="0,0,10,0"/>
            <Button Content="编辑产品"
                    Command="{Binding EditProductCommand}"
                    Style="{StaticResource EditButtonStyle}"
                    Width="100"
                    Height="35"
                    Margin="0,0,10,0"/>
            <Button Content="删除产品"
                    Command="{Binding DeleteProductCommand}"
                    Style="{StaticResource DeleteButtonStyle}"
                    Width="100"
                    Height="35"
                    Margin="0,0,10,0"/>
            <Button Content="刷新"
                    Command="{Binding RefreshCommand}"
                    Style="{StaticResource PrimaryButtonStyle}"
                    Width="80"
                    Height="35"
                    Margin="0,0,10,0"/>
        </StackPanel>

        <!-- Data Grid -->
        <Border Grid.Row="2"
                BorderBrush="{StaticResource BorderBrush}"
                BorderThickness="1"
                Background="White">
            <Grid>
                <!-- Loading Indicator -->
                <Grid Visibility="{Binding IsLoading, Converter={StaticResource BooleanToVisibilityConverter}}">
                    <Grid.Background>
                        <SolidColorBrush Color="White" Opacity="0.7"/>
                    </Grid.Background>
                    <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                        <ProgressBar IsIndeterminate="True" Width="200" Height="20" Margin="0,0,0,10"/>
                        <TextBlock Text="正在加载..."
                                   Style="{StaticResource GlobalTextStyle}"
                                   HorizontalAlignment="Center"/>
                    </StackPanel>
                </Grid>

                <!-- Products Data Grid -->
                <DataGrid x:Name="ProductsDataGrid"
                          ItemsSource="{Binding Products}"
                          SelectedItem="{Binding SelectedProduct}"
                          Style="{StaticResource StandardDataGridStyle}"
                          ColumnHeaderStyle="{StaticResource DataGridColumnHeaderStyle}"
                          RowStyle="{StaticResource DataGridRowStyle}">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="产品名称"
                                            Binding="{Binding Name}"
                                            Width="180"
                                            IsReadOnly="True"/>
                        <DataGridTextColumn Header="型号规格"
                                            Binding="{Binding SpecificationDisplay}"
                                            Width="120"
                                            IsReadOnly="True"/>
                        <DataGridTextColumn Header="计量单位"
                                            Binding="{Binding UnitDisplay}"
                                            Width="80"
                                            IsReadOnly="True"/>
                        <DataGridTextColumn Header="产品定价"
                                            Binding="{Binding FormattedListPrice}"
                                            Width="100"
                                            IsReadOnly="True"/>
                        <DataGridTextColumn Header="最低控价"
                                            Binding="{Binding FormattedMinPrice}"
                                            Width="100"
                                            IsReadOnly="True"/>
                        <DataGridTextColumn Header="销售提成"
                                            Binding="{Binding FormattedSalesCommission}"
                                            Width="100"
                                            IsReadOnly="True"/>
                        <DataGridTextColumn Header="主管提成"
                                            Binding="{Binding FormattedSupervisorCommission}"
                                            Width="100"
                                            IsReadOnly="True"/>
                        <DataGridTextColumn Header="经理提成"
                                            Binding="{Binding FormattedManagerCommission}"
                                            Width="100"
                                            IsReadOnly="True"/>
                        <DataGridTemplateColumn Header="操作" Width="120">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                        <Button Content="编辑"
                                                Command="{Binding DataContext.EditProductRowCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                CommandParameter="{Binding}"
                                                Style="{StaticResource EditButtonStyle}"
                                                Width="50"
                                                Height="25"
                                                Margin="2"/>
                                        <Button Content="删除"
                                                Command="{Binding DataContext.DeleteProductRowCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                CommandParameter="{Binding}"
                                                Style="{StaticResource DeleteButtonStyle}"
                                                Width="50"
                                                Height="25"
                                                Margin="2"/>
                                    </StackPanel>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>
                    </DataGrid.Columns>
                </DataGrid>
            </Grid>
        </Border>
    </Grid>
</UserControl>